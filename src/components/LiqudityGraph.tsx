import { BarChart } from "@mui/x-charts/BarChart";
import React, { useEffect, useState } from "react";
import { satsToBtc } from "../utils";
import { Divider } from "@material-ui/core";

// Legacy data as fallback
const STATIC_STATS = [
  ["2023-11-25T00:00:00.000Z", 16416727],
  ["2023-11-26T00:00:00.000Z", 16301355],
  ["2023-11-27T00:00:00.000Z", 15295720],
  ["2023-11-28T00:00:00.000Z", 15294922],
  ["2023-11-29T00:00:00.000Z", 15292061],
  ["2023-11-30T00:00:00.000Z", 15295720],
  ["2023-12-01T00:00:00.000Z", 16400000],
  ["2023-12-02T00:00:00.000Z", 16400000],
  ["2023-12-03T00:00:00.000Z", 16400000],
  ["2023-12-04T00:00:00.000Z", 16392262],
  ["2023-12-05T00:00:00.000Z", 208629],
  ["2023-12-06T00:00:00.000Z", 774804],
  ["2023-12-07T00:00:00.000Z", 123259],
  ["2023-12-08T00:00:00.000Z", 0],
  ["2023-12-09T00:00:00.000Z", 0],
  ["2023-12-10T00:00:00.000Z", 0],
  ["2023-12-11T00:00:00.000Z", 0],
  ["2023-12-13T00:00:00.000Z", 1348041],
  ["2023-12-14T00:00:00.000Z", 45706],
  ["2023-12-15T00:00:00.000Z", 47661],
  ["2023-12-16T00:00:00.000Z", 0],
  ["2023-12-17T00:00:00.000Z", 0],
  ["2023-12-18T00:00:00.000Z", 152942],
  ["2023-12-19T00:00:00.000Z", 81575],
  ["2023-12-20T00:00:00.000Z", 80793],
  ["2023-12-21T00:00:00.000Z", 0],
  ["2023-12-22T00:00:00.000Z", 0],
  ["2023-12-23T00:00:00.000Z", 0],
  ["2023-12-24T00:00:00.000Z", 0],
  ["2023-12-25T00:00:00.000Z", 0],
  ["2023-12-26T00:00:00.000Z", 0],
  ["2023-12-27T00:00:00.000Z", 0],
  ["2023-12-28T00:00:00.000Z", 0],
  ["2023-12-29T00:00:00.000Z", 0],
  ["2023-12-30T00:00:00.000Z", 0],
  ["2023-12-31T00:00:00.000Z", 0],
  ["2024-01-01T00:00:00.000Z", 0],
  ["2024-01-02T00:00:00.000Z", 0],
  ["2024-01-03T00:00:00.000Z", 0],
  ["2024-01-04T00:00:00.000Z", 0],
  ["2024-01-05T00:00:00.000Z", 0],
  ["2024-01-06T00:00:00.000Z", 0],
  ["2024-01-07T00:00:00.000Z", 0],
  ["2024-01-08T00:00:00.000Z", 0],
  ["2024-01-09T00:00:00.000Z", 0],
  ["2024-01-10T00:00:00.000Z", 0],
  ["2024-01-11T00:00:00.000Z", 0],
  ["2024-01-12T00:00:00.000Z", 0],
  ["2024-01-13T00:00:00.000Z", 1202400],
  ["2024-01-14T00:00:00.000Z", 1224924],
  ["2024-01-15T00:00:00.000Z", 0],
  ["2024-01-16T00:00:00.000Z", 0],
  ["2024-01-17T00:00:00.000Z", 2000000],
  ["2024-01-18T00:00:00.000Z", 4000000],
  ["2024-01-19T00:00:00.000Z", 3000000],
  ["2024-01-20T00:00:00.000Z", 3000000],
  ["2024-01-21T00:00:00.000Z", 5036265],
  ["2024-01-22T00:00:00.000Z", 7265667],
  ["2024-01-23T00:00:00.000Z", 7251755],
  ["2024-01-24T00:00:00.000Z", 7178607],
  ["2024-01-25T00:00:00.000Z", 6064231],
  ["2024-01-26T00:00:00.000Z", 9375018],
  ["2024-01-27T00:00:00.000Z", 1400000],
  ["2024-01-28T00:00:00.000Z", 1353754],
  ["2024-01-29T00:00:00.000Z", 1374276],
  ["2024-01-30T00:00:00.000Z", 718324],
  ["2024-01-31T00:00:00.000Z", 1030149],
  ["2024-02-01T00:00:00.000Z", 4472686],
  ["2024-02-02T00:00:00.000Z", 7163085],
  ["2024-02-03T00:00:00.000Z", 6981110],
  ["2024-02-04T00:00:00.000Z", 8616294],
  ["2024-02-05T00:00:00.000Z", 13413046],
  ["2024-02-06T00:00:00.000Z", 3410559],
  ["2024-02-07T00:00:00.000Z", 14409971],
  ["2024-02-08T00:00:00.000Z", 2857856],
  ["2024-02-09T00:00:00.000Z", 9663845],
  ["2024-02-10T00:00:00.000Z", 15434163],
  ["2024-02-11T00:00:00.000Z", 15339197],
  ["2024-02-12T00:00:00.000Z", 13526288],
  ["2024-02-13T00:00:00.000Z", 13848565],
  ["2024-02-14T00:00:00.000Z", 11815267],
  ["2024-02-15T00:00:00.000Z", 9392876],
  ["2024-02-16T00:00:00.000Z", 16709395],
  ["2024-02-17T00:00:00.000Z", 12482189],
  ["2024-02-18T00:00:00.000Z", 13502421],
  ["2024-02-19T00:00:00.000Z", 16291193],
  ["2024-02-20T00:00:00.000Z", 15669556],
  ["2024-02-21T00:00:00.000Z", 13443685],
  ["2024-02-22T00:00:00.000Z", 13711757],
  ["2024-02-23T00:00:00.000Z", 10489402],
  ["2024-02-24T00:00:00.000Z", 7315467],
  ["2024-02-25T00:00:00.000Z", 14154657],
  ["2024-02-26T00:00:00.000Z", 9519300],
  ["2024-02-27T00:00:00.000Z", 17535976],
  ["2024-02-28T00:00:00.000Z", 10775105],
  ["2024-02-29T00:00:00.000Z", 15277575],
  ["2024-03-01T00:00:00.000Z", 7348287],
  ["2024-03-02T00:00:00.000Z", 5217092],
  ["2024-03-03T00:00:00.000Z", 5301131],
  ["2024-03-04T00:00:00.000Z", 4872087],
  ["2024-03-05T00:00:00.000Z", 10286336],
  ["2024-03-06T00:00:00.000Z", 11280297],
  ["2024-03-07T00:00:00.000Z", 14022722],
  ["2024-03-08T00:00:00.000Z", 11570262],
  ["2024-03-09T00:00:00.000Z", 13099743],
  ["2024-03-10T00:00:00.000Z", 6405609],
  ["2024-03-11T00:00:00.000Z", 23026224],
  ["2024-03-12T00:00:00.000Z", 26909510],
  ["2024-03-13T00:00:00.000Z", 26887551],
  ["2024-03-14T00:00:00.000Z", 26772408],
  ["2024-03-15T00:00:00.000Z", 24152687],
  ["2024-03-16T00:00:00.000Z", 25130587],
  ["2024-03-17T00:00:00.000Z", 27911308],
  ["2024-03-18T00:00:00.000Z", 28381900],
  ["2024-03-19T00:00:00.000Z", 27346695],
  ["2024-03-20T00:00:00.000Z", 25632498],
  ["2024-03-21T00:00:00.000Z", 19042685],
  ["2024-03-22T00:00:00.000Z", 28068003],
  ["2024-03-23T00:00:00.000Z", 18604672],
  ["2024-03-24T00:00:00.000Z", 26689920],
  ["2024-03-25T00:00:00.000Z", 24712542],
  ["2024-03-26T00:00:00.000Z", 24746456],
  ["2024-03-27T00:00:00.000Z", 25398338],
  ["2024-03-28T00:00:00.000Z", 16305013],
  ["2024-03-29T00:00:00.000Z", 26746498],
  ["2024-03-30T00:00:00.000Z", 26084812],
  ["2024-03-31T00:00:00.000Z", 28789341],
  ["2024-04-01T00:00:00.000Z", 26315361],
  ["2024-04-02T00:00:00.000Z", 15965655],
  ["2024-04-03T00:00:00.000Z", 21052999],
  ["2024-04-04T00:00:00.000Z", 26918736],
  ["2024-04-05T00:00:00.000Z", 24186887],
  ["2024-04-06T00:00:00.000Z", 16976272],
  ["2024-04-07T00:00:00.000Z", 19389460],
  ["2024-04-08T00:00:00.000Z", 24875828],
  ["2024-04-09T00:00:00.000Z", 24591233],
  ["2024-04-10T00:00:00.000Z", 28443387],
  ["2024-04-11T00:00:00.000Z", 28608562],
  ["2024-04-12T00:00:00.000Z", 27218937],
  ["2024-04-13T00:00:00.000Z", 25499489],
  ["2024-04-14T00:00:00.000Z", 32273115],
  ["2024-04-15T00:00:00.000Z", 31791070],
  ["2024-04-16T00:00:00.000Z", 46883497],
  ["2024-04-17T00:00:00.000Z", 36650540],
  ["2024-04-18T00:00:00.000Z", 34472969],
  ["2024-04-19T00:00:00.000Z", 43677723],
  ["2024-04-20T00:00:00.000Z", 37892614],
  ["2024-04-21T00:00:00.000Z", 44702323],
  ["2024-04-22T00:00:00.000Z", 37100305],
  ["2024-04-23T00:00:00.000Z", 27976086],
  ["2024-04-24T00:00:00.000Z", 22100531],
  ["2024-04-25T00:00:00.000Z", 22447313],
  ["2024-04-26T00:00:00.000Z", 22357799],
  ["2024-04-27T00:00:00.000Z", 16387829],
  ["2024-04-28T00:00:00.000Z", 1989576],
  ["2024-04-29T00:00:00.000Z", 9932856],
  ["2024-04-30T00:00:00.000Z", 9657907],
  ["2024-05-01T00:00:00.000Z", 22326726],
  ["2024-05-02T00:00:00.000Z", 32352623],
  ["2024-05-03T00:00:00.000Z", 31839007],
  ["2024-05-04T00:00:00.000Z", 19318701],
  ["2024-05-05T00:00:00.000Z", 30252495],
  ["2024-05-06T00:00:00.000Z", 22724726],
  ["2024-05-07T00:00:00.000Z", 21715485],
  ["2024-05-08T00:00:00.000Z", 7126127],
  ["2024-05-09T00:00:00.000Z", 12123429],
  ["2024-05-10T00:00:00.000Z", 33487057],
  ["2024-05-11T00:00:00.000Z", 31302256],
  ["2024-05-12T00:00:00.000Z", 27010808],
  ["2024-05-13T00:00:00.000Z", 23410703],
  ["2024-05-14T00:00:00.000Z", 21361102],
  ["2024-05-15T00:00:00.000Z", 24570391],
  ["2024-05-16T00:00:00.000Z", 11989961],
  ["2024-05-17T00:00:00.000Z", 37740068],
  ["2024-05-18T00:00:00.000Z", 34557322],
  ["2024-05-19T00:00:00.000Z", 32711283],
  ["2024-05-20T00:00:00.000Z", 27482090],
  ["2024-05-21T00:00:00.000Z", 28683010],
  ["2024-05-22T00:00:00.000Z", 30146452],
  ["2024-05-23T00:00:00.000Z", 29266152],
  ["2024-05-24T00:00:00.000Z", 33859779],
  ["2024-05-25T00:00:00.000Z", 27709058],
  ["2024-05-26T00:00:00.000Z", 26023447],
  ["2024-05-27T00:00:00.000Z", 32597233],
  ["2024-05-28T00:00:00.000Z", 32254253],
  ["2024-05-29T00:00:00.000Z", 50774680],
  ["2024-05-30T00:00:00.000Z", 46691454],
  ["2024-05-31T00:00:00.000Z", 43331006],
  ["2024-06-01T00:00:00.000Z", 55128977],
  ["2024-06-02T00:00:00.000Z", 47456135],
  ["2024-06-03T00:00:00.000Z", 60355184],
  ["2024-06-04T00:00:00.000Z", 62425723],
  ["2024-06-05T00:00:00.000Z", 67848662],
  ["2024-06-06T00:00:00.000Z", 67150437],
  ["2024-06-10T00:00:00.000Z", 144259174],
  ["2024-06-11T00:00:00.000Z", 59721447],
  ["2024-06-12T00:00:00.000Z", 78826885],
  ["2024-06-13T00:00:00.000Z", 68021692],
  ["2024-06-14T00:00:00.000Z", 72918003],
  ["2024-06-15T00:00:00.000Z", 73026651],
  ["2024-06-16T00:00:00.000Z", 113240646],
  ["2024-06-17T00:00:00.000Z", 113788458],
  ["2024-06-18T00:00:00.000Z", 110110417],
  ["2024-06-19T00:00:00.000Z", 133921125],
  ["2024-06-20T00:00:00.000Z", 58969191],
  ["2024-06-21T00:00:00.000Z", 74967974],
  ["2024-06-22T00:00:00.000Z", 112629930],
  ["2024-06-23T00:00:00.000Z", 116673176],
  ["2024-06-24T00:00:00.000Z", 99167744],
  ["2024-06-25T00:00:00.000Z", 88415643],
  ["2024-06-26T00:00:00.000Z", 87511837],
  ["2024-06-27T00:00:00.000Z", 91265369],
  ["2024-06-28T00:00:00.000Z", 90820317],
  ["2024-06-29T00:00:00.000Z", 72041469],
  ["2024-06-30T00:00:00.000Z", 77335901],
  ["2024-07-01T00:00:00.000Z", 68830668],
  ["2024-07-02T00:00:00.000Z", 79285750],
  ["2024-07-03T00:00:00.000Z", 78587307],
  ["2024-07-04T00:00:00.000Z", 77221181],
  ["2024-07-05T00:00:00.000Z", 71748412],
  ["2024-07-06T00:00:00.000Z", 68281736],
  ["2024-07-07T00:00:00.000Z", 88238330],
  ["2024-07-08T00:00:00.000Z", 92329445],
  ["2024-07-09T00:00:00.000Z", 96637959],
  ["2024-07-10T00:00:00.000Z", 88554524],
  ["2024-07-11T00:00:00.000Z", 95541002],
  ["2024-07-12T00:00:00.000Z", 96451020],
  ["2024-07-13T00:00:00.000Z", 89750971],
  ["2024-07-14T00:00:00.000Z", 91285280],
  ["2024-07-15T00:00:00.000Z", 84453283],
  ["2024-07-16T00:00:00.000Z", 87911511],
  ["2024-07-17T00:00:00.000Z", 86523143],
  ["2024-07-18T00:00:00.000Z", 62507752],
  ["2024-07-19T00:00:00.000Z", 82245844],
  ["2024-07-20T00:00:00.000Z", 61839625],
  ["2024-07-21T00:00:00.000Z", 78437304],
  ["2024-07-22T00:00:00.000Z", 56939769],
  ["2024-07-23T00:00:00.000Z", 74205483],
  ["2024-07-24T00:00:00.000Z", 61627295],
  ["2024-07-25T00:00:00.000Z", 29419160],
  ["2024-07-26T00:00:00.000Z", 42000000],
  ["2024-07-27T00:00:00.000Z", 80987203],
  ["2024-07-28T00:00:00.000Z", 82058694],
  ["2024-07-29T00:00:00.000Z", 78503896],
  ["2024-07-30T00:00:00.000Z", 61956633],
  ["2024-07-31T00:00:00.000Z", 82010611],
  ["2024-08-01T00:00:00.000Z", 74694524],
  ["2024-08-02T00:00:00.000Z", 124570919],
  ["2024-08-03T00:00:00.000Z", 122428419],
  ["2024-08-04T00:00:00.000Z", 124543266],
  ["2024-08-05T00:00:00.000Z", 124849439],
  ["2024-08-06T00:00:00.000Z", 122786602],
  ["2024-08-07T00:00:00.000Z", 122942044],
  ["2024-08-08T00:00:00.000Z", 104823965],
  ["2024-08-09T00:00:00.000Z", 106990439],
  ["2024-08-10T00:00:00.000Z", 107013835],
  ["2024-08-11T00:00:00.000Z", 106956276],
  ["2024-08-12T00:00:00.000Z", 130376264],
  ["2024-08-13T00:00:00.000Z", 132707473],
  ["2024-08-14T00:00:00.000Z", 131652235],
  ["2024-08-15T00:00:00.000Z", 130452879],
  ["2024-08-16T00:00:00.000Z", 127379198],
  ["2024-08-17T00:00:00.000Z", 124325051],
  ["2024-08-18T00:00:00.000Z", 131477636],
  ["2024-08-19T00:00:00.000Z", 140148525],
  ["2024-08-20T00:00:00.000Z", 138785092],
  ["2024-08-21T00:00:00.000Z", 127376919],
  ["2024-08-22T00:00:00.000Z", 145834794],
  ["2024-08-23T00:00:00.000Z", 143314839],
  ["2024-08-24T00:00:00.000Z", 136243610],
  ["2024-08-25T00:00:00.000Z", 115901868],
  ["2024-08-26T00:00:00.000Z", 119058490],
  ["2024-08-27T00:00:00.000Z", 114866861],
  ["2024-08-28T00:00:00.000Z", 87346652],
  ["2024-08-29T00:00:00.000Z", 65000000],
  ["2024-08-30T00:00:00.000Z", 74193717],
  ["2024-08-31T00:00:00.000Z", 43620916],
  ["2024-09-01T00:00:00.000Z", 4882177],
  ["2024-09-02T00:00:00.000Z", 63428862],
  ["2024-09-03T00:00:00.000Z", 148389195],
  ["2024-09-04T00:00:00.000Z", 126722604],
  ["2024-09-05T00:00:00.000Z", 191168244],
  ["2024-09-06T00:00:00.000Z", 190258127],
  ["2024-09-07T00:00:00.000Z", 204218251],
  ["2024-09-08T00:00:00.000Z", 272650586],
  ["2024-09-09T00:00:00.000Z", 173590020],
  ["2024-09-10T00:00:00.000Z", 199481155],
  ["2024-09-11T00:00:00.000Z", 276218268],
  ["2024-09-12T00:00:00.000Z", 252497844],
  ["2024-09-13T00:00:00.000Z", 269649925],
  ["2024-09-14T00:00:00.000Z", 267097243],
  ["2024-09-15T00:00:00.000Z", 466678160],
  ["2024-09-16T00:00:00.000Z", 456258858],
  ["2024-09-17T00:00:00.000Z", 315169147],
  ["2024-09-18T00:00:00.000Z", 309189521],
  ["2024-09-19T00:00:00.000Z", 284849160],
  ["2024-09-20T00:00:00.000Z", 307309358],
  ["2024-09-21T00:00:00.000Z", 304692315],
  ["2024-09-22T00:00:00.000Z", 303022211],
  ["2024-09-23T00:00:00.000Z", 300894380],
  ["2024-09-24T00:00:00.000Z", 292586200],
  ["2024-09-25T00:00:00.000Z", 295730276],
  ["2024-09-26T00:00:00.000Z", 289862411],
  ["2024-09-27T00:00:00.000Z", 289483430],
  ["2024-09-28T00:00:00.000Z", 288588077],
  ["2024-09-29T00:00:00.000Z", 285360087],
  ["2024-09-30T00:00:00.000Z", 180857028],
  ["2024-10-01T00:00:00.000Z", 248375214],
  ["2024-10-02T00:00:00.000Z", 274571234],
  ["2024-10-03T00:00:00.000Z", 258367906],
  ["2024-10-04T00:00:00.000Z", 247630035],
  ["2024-10-05T00:00:00.000Z", 305426206],
  ["2024-10-06T00:00:00.000Z", 300867772],
  ["2024-10-07T00:00:00.000Z", 295857491],
  ["2024-10-08T00:00:00.000Z", 297489812],
  ["2024-10-09T00:00:00.000Z", 289128733],
  ["2024-10-10T00:00:00.000Z", 294552966],
  ["2024-10-11T00:00:00.000Z", 288233334],
  ["2024-10-12T00:00:00.000Z", 277328268],
  ["2024-10-13T00:00:00.000Z", 303122530],
  ["2024-10-14T00:00:00.000Z", 277925740],
  ["2024-10-15T00:00:00.000Z", 269033604],
  ["2024-10-16T00:00:00.000Z", 267525022],
  ["2024-10-17T00:00:00.000Z", 226375650],
  ["2024-10-18T00:00:00.000Z", 211121802],
  ["2024-10-19T00:00:00.000Z", 336598778],
  ["2024-10-20T00:00:00.000Z", 357633223],
  ["2024-10-21T00:00:00.000Z", 334252411],
  ["2024-10-22T00:00:00.000Z", 341506665],
  ["2024-10-23T00:00:00.000Z", 343900859],
  ["2024-10-24T00:00:00.000Z", 338063044],
  ["2024-10-25T00:00:00.000Z", 349878896],
  ["2024-10-26T00:00:00.000Z", 344139320],
  ["2024-10-27T00:00:00.000Z", 350004249],
  ["2024-10-28T00:00:00.000Z", 315345043],
  ["2024-10-29T00:00:00.000Z", 297888103],
  ["2024-10-30T00:00:00.000Z", 191358766],
  ["2024-10-31T00:00:00.000Z", 169490690],
  ["2024-11-01T00:00:00.000Z", 267308482],
  ["2024-11-02T00:00:00.000Z", 334977236],
  ["2024-11-03T00:00:00.000Z", 343529369],
  ["2024-11-04T00:00:00.000Z", 342376121],
  ["2024-11-05T00:00:00.000Z", 343917168],
  ["2024-11-06T00:00:00.000Z", 307338098],
  ["2024-11-07T00:00:00.000Z", 318037508],
  ["2024-11-08T00:00:00.000Z", 277830508],
  ["2024-11-09T00:00:00.000Z", 308865379],
  ["2024-11-10T00:00:00.000Z", 315957170],
  ["2024-11-11T00:00:00.000Z", 298566873],
  ["2024-11-12T00:00:00.000Z", 283432785],
  ["2024-11-13T00:00:00.000Z", 273000752],
  ["2024-11-14T00:00:00.000Z", 267386219],
  ["2024-11-15T00:00:00.000Z", 324471246],
] as [string, number][];

interface ApiDataPoint {
  date: [number, number, number, number, number, number];
  totalLiquidityBtc: number;
}

export function LiquidityGraph() {
  const [mergedData, setMergedData] = useState<[string, number][]>(STATIC_STATS);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch('https://api.unstoppableswap.net/api/liquidity-daily');
        const apiData: ApiDataPoint[] = await response.json();

        const processedApiData = apiData.map(item => {
          const date = new Date(Date.UTC(item.date[0], 0, 1));
          date.setUTCDate(item.date[1]);
          return [
            date.toISOString(),
            Math.round(item.totalLiquidityBtc * 100000000)
          ] as [string, number];
        });

        const mergedArray = Array.from(
          new Map([...STATIC_STATS, ...processedApiData]).entries()
        ).sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime());

        setMergedData(mergedArray);
      } catch (error) {
        console.error('Failed to fetch liquidity data:', error);
      }
    };

    fetchData();
  }, []);

  return mergedData.length > 0 ? (
    <>
      <Divider style={{ width: "100%" }} />
      <BarChart
        tooltip={{
          trigger: "none",
        }}
        xAxis={[
          {
            data: mergedData.map((item) => new Date(item[0])),
            scaleType: "band",
            tickLabelStyle: { fill: "white" },
            valueFormatter: (date: Date) => 
              date.toLocaleDateString(undefined, { month: "short", day: "numeric" }),
          },
        ]}
        yAxis={[
          {
            label: "Total liquidity (BTC)",
            labelStyle: { fill: "white" },
            tickLabelStyle: { fill: "white" },
          },
        ]}
        series={[
          {
            data: mergedData.map((item) => satsToBtc(Number(item[1]))),
            color: "#f4511e",
          },
        ]}
        height={300}
        sx={{
          "& .MuiChartsLegend-label": {
            fill: "white",
          },
        }}
      />
    </>
  ) : null;
}

export default LiquidityGraph;
